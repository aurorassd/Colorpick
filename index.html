<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>リアルタイム カラーミキサー v2.2</title> <!-- バージョン更新 -->
    <style>
        /* --- 全体的なスタイル (変更なし) --- */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 20px; background-color: #f0f2f5; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; color: #333; }
        .container { background-color: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08); display: flex; flex-wrap: wrap; gap: 30px; max-width: 1100px; width: 100%; }
        h1 { width: 100%; text-align: center; margin-top: 0; margin-bottom: 25px; color: #1a1a1a; font-weight: 600; font-size: 1.8em; }

        /* --- メインレイアウト (変更なし) --- */
        .main-content { flex: 2 1 500px; display: flex; flex-direction: column; gap: 20px; }
        .sidebar { flex: 1 1 300px; display: flex; flex-direction: column; gap: 20px; }

        /* --- 色設定エリア --- */
        .color-settings { display: flex; flex-direction: column; gap: 20px; }
        .color-control { border: 1px solid #e0e0e0; padding: 15px; border-radius: 8px; background-color: #fdfdfd; display: grid; grid-template-columns: auto 1fr auto; grid-template-rows: auto auto auto; gap: 10px 15px; align-items: center; transition: box-shadow 0.2s ease-in-out; }
        .color-control:focus-within { box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25); }
        .color-control label { font-weight: 600; grid-column: 1 / 2; grid-row: 1 / 2; color: #444; }

        /* --- カラーピッカーコンテナ調整 --- */
        .color-picker-container {
            grid-column: 2 / 3;
            grid-row: 1 / 2;
            display: flex;
            align-items: center;
            gap: 8px; /* ギャップ調整 */
        }

        .color-control input[type="color"] {
            width: 40px;
            height: 40px;
            border: 1px solid #ccc;
            border-radius: 6px;
            cursor: pointer;
            padding: 0;
            background-color: transparent;
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            vertical-align: middle;
        }
        .color-control input[type="color"]::-webkit-color-swatch-wrapper { padding: 0; }
        .color-control input[type="color"]::-webkit-color-swatch { border: none; border-radius: 5px; }
        .color-control input[type="color"]::-moz-color-swatch { border: none; border-radius: 5px; }

        /* ★★★ スポイトボタンのスタイル ★★★ */
        .eyedropper-button {
            width: 30px;
            height: 30px;
            padding: 0;
            border: 1px solid #ccc;
            background-color: #f8f9fa;
            color: #333;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.2em; /* 絵文字が見やすいように */
            line-height: 28px; /* アイコンの中央揃え */
            text-align: center;
            transition: background-color 0.2s, border-color 0.2s;
            vertical-align: middle;
            flex-shrink: 0; /* サイズが縮まないように */
        }
        .eyedropper-button:hover { background-color: #e9ecef; border-color: #bbb; }
        .eyedropper-button:active { background-color: #d6dadf; }
        .eyedropper-button:disabled { /* API非対応時のスタイル */
            cursor: not-allowed;
            opacity: 0.6;
            background-color: #eee;
        }
        /* ★★★ ここまで ★★★ */


        .enable-switch-container { grid-column: 3 / 4; grid-row: 1 / 2; display: flex; align-items: center; justify-content: flex-end; }
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider-track { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider-track:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        input:checked + .slider-track { background-color: #007bff; }
        input:checked + .slider-track:before { transform: translateX(20px); }
        .slider-container { grid-column: 1 / 4; grid-row: 2 / 3; display: flex; align-items: center; gap: 15px; }
        .color-control input[type="range"] { flex-grow: 1; cursor: pointer; height: 8px; border-radius: 4px; background: linear-gradient(to right, #e0e0e0, #e0e0e0); appearance: none; outline: none; transition: background 0.2s ease; }
        .color-control input[type="range"]::-webkit-slider-thumb { appearance: none; width: 18px; height: 18px; background: #007bff; border-radius: 50%; cursor: pointer; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .color-control input[type="range"]::-moz-range-thumb { width: 18px; height: 18px; background: #007bff; border-radius: 50%; cursor: pointer; border: none; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .percentage-display { font-weight: 600; min-width: 45px; text-align: right; color: #555; }
        .quick-settings { grid-column: 1 / 4; grid-row: 3 / 4; display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px; }
        .quick-settings button { font-size: 0.75em; padding: 3px 6px; border: 1px solid #ccc; background-color: #f8f9fa; color: #333; border-radius: 4px; cursor: pointer; transition: background-color 0.2s, border-color 0.2s; line-height: 1; }
        .quick-settings button:hover { background-color: #e9ecef; border-color: #bbb; }
        .quick-settings button:active { background-color: #d6dadf; }

        /* --- 結果表示エリア (変更なし) --- */
        .result-area { display: flex; flex-direction: column; gap: 15px; }
        .result-display { min-height: 150px; border: 1px solid #ccc; border-radius: 8px; background-color: #ffffff; display: flex; justify-content: center; align-items: center; text-align: center; transition: background-color 0.3s ease; box-shadow: inset 0 0 10px rgba(0,0,0,0.05); position: relative; }
        .result-text { background-color: rgba(255, 255, 255, 0.85); padding: 12px 18px; border-radius: 6px; font-size: 1.2em; font-weight: 600; color: #333; transition: color 0.3s ease, background-color 0.3s ease; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: default; user-select: none; }
        .save-button { padding: 12px 20px; font-size: 1em; font-weight: 600; color: #fff; background-color: #28a745; border: none; border-radius: 6px; cursor: pointer; transition: background-color 0.2s ease; width: 100%; box-sizing: border-box; }
        .save-button:hover { background-color: #218838; }
        .save-button:active { background-color: #1e7e34; }

        /* --- 保存リストエリア (変更なし) --- */
        .saved-colors-section { background-color: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #e0e0e0; display: flex; flex-direction: column; flex-grow: 1; min-height: 200px; overflow: hidden; }
        .saved-colors-section h2 { margin-top: 0; margin-bottom: 15px; font-size: 1.3em; font-weight: 600; color: #333; text-align: center; flex-shrink: 0; }
        #savedColorsList { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex-grow: 1; border: 1px solid #ddd; border-radius: 4px; background-color: #fff; }
        #savedColorsList li { display: flex; align-items: center; padding: 10px 15px; border-bottom: 1px solid #eee; cursor: pointer; transition: background-color 0.2s ease; }
        #savedColorsList li:last-child { border-bottom: none; }
        #savedColorsList li:hover { background-color: #f0f8ff; }
        .saved-color-swatch { width: 30px; height: 30px; border-radius: 4px; margin-right: 15px; border: 1px solid #ccc; flex-shrink: 0; }
        .saved-color-info { display: flex; flex-direction: column; flex-grow: 1; overflow: hidden; }
        .saved-color-hex { font-weight: 600; font-size: 0.95em; color: #333; white-space: nowrap; }
        .saved-color-details { font-size: 0.8em; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* --- レスポンシブ対応 (変更なし) --- */
        @media (max-width: 992px) { .container { flex-direction: column; max-width: 700px; } .main-content, .sidebar { flex-basis: auto; width: 100%; } .saved-colors-section { min-height: 250px; max-height: 40vh; } }
        @media (max-width: 768px) {
            .container { padding: 15px; } h1 { font-size: 1.6em; margin-bottom: 20px; }
            .color-control { grid-template-columns: auto 1fr; grid-template-rows: auto auto auto auto; gap: 8px 10px; }
            .color-control label { grid-row: 1 / 2; grid-column: 1 / 2; }
            .color-picker-container { grid-row: 1 / 2; grid-column: 2 / 3; justify-content: flex-start; }
            .enable-switch-container { grid-row: 2 / 3; grid-column: 1 / 3; justify-content: flex-start; padding-top: 5px; }
            .slider-container { grid-row: 3 / 4; grid-column: 1 / 3; }
            .quick-settings { grid-row: 4 / 5; grid-column: 1 / 3; }
            .result-display { min-height: 120px; } .result-text { font-size: 1.1em; padding: 10px 15px; }
            .save-button { padding: 10px 15px; font-size: 0.95em; }
            .saved-colors-section { padding: 15px; max-height: 35vh; } .saved-colors-section h2 { font-size: 1.2em; }
            #savedColorsList li { padding: 8px 12px; } .saved-color-swatch { width: 25px; height: 25px; margin-right: 10px; }
            .saved-color-hex { font-size: 0.9em; } .saved-color-details { font-size: 0.75em; }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>リアルタイム カラーミキサー v2.2</h1>

        <!-- メインコンテンツ (色設定) -->
        <div class="main-content">
            <div class="color-settings">
                <!-- Color Control 1 -->
                <div class="color-control" id="colorControl1">
                    <label for="color1">色 1:</label>
                    <div class="color-picker-container">
                        <input type="color" id="color1" value="#ff0000">
                      
                        <button class="eyedropper-button" data-target-color-input="color1" title="スポイト">💧</button>
                    </div>
                    <div class="enable-switch-container"><label class="switch"><input type="checkbox" id="enable1" checked><span class="slider-track"></span></label></div>
                    <div class="slider-container"><input type="range" id="ratio1" min="0" max="100" value="100" class="ratio-slider"><span class="percentage-display" id="ratioDisplay1">100%</span></div>
                    <div class="quick-settings" id="quickSettings1"></div>
                </div>
                <!-- Color Control 2 -->
                 <div class="color-control" id="colorControl2">
                    <label for="color2">色 2:</label>
                    <div class="color-picker-container">
                        <input type="color" id="color2" value="#0000ff">
                        <button class="eyedropper-button" data-target-color-input="color2" title="スポイト">💧</button>
                    </div>
                    <div class="enable-switch-container"><label class="switch"><input type="checkbox" id="enable2"><span class="slider-track"></span></label></div>
                    <div class="slider-container"><input type="range" id="ratio2" min="0" max="100" value="0" class="ratio-slider"><span class="percentage-display" id="ratioDisplay2">0%</span></div>
                     <div class="quick-settings" id="quickSettings2"></div>
                </div>
                <!-- Color Control 3 -->
                <div class="color-control" id="colorControl3">
                    <label for="color3">色 3:</label>
                    <div class="color-picker-container">
                        <input type="color" id="color3" value="#00ff00">
                        <button class="eyedropper-button" data-target-color-input="color3" title="スポイト">💧</button>
                    </div>
                    <div class="enable-switch-container"><label class="switch"><input type="checkbox" id="enable3"><span class="slider-track"></span></label></div>
                    <div class="slider-container"><input type="range" id="ratio3" min="0" max="100" value="0" class="ratio-slider"><span class="percentage-display" id="ratioDisplay3">0%</span></div>
                     <div class="quick-settings" id="quickSettings3"></div>
                </div>
                <!-- Color Control 4 -->
                <div class="color-control" id="colorControl4">
                    <label for="color4">色 4:</label>
                    <div class="color-picker-container">
                        <input type="color" id="color4" value="#ffff00">
                        <button class="eyedropper-button" data-target-color-input="color4" title="スポイト">💧</button>
                    </div>
                    <div class="enable-switch-container"><label class="switch"><input type="checkbox" id="enable4"><span class="slider-track"></span></label></div>
                    <div class="slider-container"><input type="range" id="ratio4" min="0" max="100" value="0" class="ratio-slider"><span class="percentage-display" id="ratioDisplay4">0%</span></div>
                     <div class="quick-settings" id="quickSettings4"></div>
                </div>
                 <!-- Color Control 5 -->
                <div class="color-control" id="colorControl5">
                    <label for="color5">色 5:</label>
                    <div class="color-picker-container">
                        <input type="color" id="color5" value="#ff00ff">
                        <button class="eyedropper-button" data-target-color-input="color5" title="スポイト">💧</button>
                    </div>
                    <div class="enable-switch-container"><label class="switch"><input type="checkbox" id="enable5"><span class="slider-track"></span></label></div>
                    <div class="slider-container"><input type="range" id="ratio5" min="0" max="100" value="0" class="ratio-slider"><span class="percentage-display" id="ratioDisplay5">0%</span></div>
                     <div class="quick-settings" id="quickSettings5"></div>
                </div>
            </div>
        </div>

        <!-- サイドバー (結果表示 + 保存リスト) (変更なし) -->
        <div class="sidebar">
             <div class="result-area">
                 <div class="result-display" id="resultDisplay">
                     <span class="result-text" id="resultText">#ff0000</span>
                 </div>
                 <button class="save-button" id="saveColorButton">現在の色を保存</button>
            </div>
            <div class="saved-colors-section">
                <h2>保存した色</h2>
                <ul id="savedColorsList"></ul>
            </div>
        </div>
    </div>

    <script>
        // --- グローバル定数, DOM要素取得 ---
        const MAX_COLORS = 5;
        const LOCAL_STORAGE_KEY = 'savedColorMixes_v2';
        const colorControls = [];
        for (let i = 1; i <= MAX_COLORS; i++) {
             colorControls.push({
                id: i,
                container: document.getElementById(`colorControl${i}`),
                colorInput: document.getElementById(`color${i}`),
                enableCheckbox: document.getElementById(`enable${i}`),
                ratioSlider: document.getElementById(`ratio${i}`),
                ratioDisplay: document.getElementById(`ratioDisplay${i}`),
                quickSettingsContainer: document.getElementById(`quickSettings${i}`)
                // eyedropperButton は後で設定
            });
        }
        const resultDisplay = document.getElementById('resultDisplay');
        const resultText = document.getElementById('resultText');
        const saveColorButton = document.getElementById('saveColorButton');
        const savedColorsListElement = document.getElementById('savedColorsList');
        const eyedropperButtons = document.querySelectorAll('.eyedropper-button'); // ★スポイトボタンを取得

        // --- 状態管理 (変更なし) ---
        let savedColorMixes = [];

        // --- イベントリスナーの設定 ---
        colorControls.forEach((control) => {
            // 既存のリスナー (変更なし)
            control.colorInput.addEventListener('input', () => { handleColorInputChange(control); });
            control.enableCheckbox.addEventListener('change', mixColorsAndUpdateUI);
            control.ratioSlider.addEventListener('input', () => { handleSliderInputChange(control); });
        });
        saveColorButton.addEventListener('click', saveCurrentColorMix);
        savedColorsListElement.addEventListener('click', (event) => { handleSavedListClick(event); });

        // ★★★ スポイトボタンのイベントリスナー ★★★
        eyedropperButtons.forEach(button => {
            const targetInputId = button.dataset.targetColorInput;
            const targetColorInput = document.getElementById(targetInputId);
            // ★ 対応する control オブジェクトをここで見つけておく
            const targetControl = colorControls.find(c => c.colorInput.id === targetInputId);

            if (!targetColorInput || !targetControl) {
                 console.error(`スポイトボタンのターゲットが見つかりません: ${targetInputId}`);
                 button.disabled = true; // 見つからなければ無効化
                 return;
            }

            // APIサポートチェック
            if (!('EyeDropper' in window)) {
                button.disabled = true;
                button.title = "このブラウザではスポイト機能はサポートされていません";
                // console.warn は initialize で一度だけ出すように変更
                return;
            }

            button.addEventListener('click', async () => {
                try {
                    const eyedropper = new EyeDropper();
                    // AbortController のインスタンスを作成
                    // const abortController = new AbortController();
                    // signal を eyedropper.open に渡す (今回は省略)
                    const result = await eyedropper.open(/*{ signal: abortController.signal }*/);

                    if (result && result.sRGBHex) {
                        targetColorInput.value = result.sRGBHex;
                        // ★ 関連するUI更新関数を呼び出す
                        handleColorInputChange(targetControl);
                    }
                } catch (error) {
                    // ユーザーキャンセルは無視、それ以外はログ出力
                    if (error.name !== 'AbortError') {
                        console.error("EyeDropper エラー:", error);
                        // ユーザーへのフィードバックが必要な場合、ここに追記
                        // alert("スポイトでエラーが発生しました。");
                    }
                }
            });
        });
        // ★★★ ここまで ★★★


        // --- ヘルパー関数 ---

        // ★ カラーピッカー入力変更時の処理を関数化
        function handleColorInputChange(control) {
             if (!control) return;
             updateSliderBackground(control);
             mixColorsAndUpdateUI();
        }

        // ★ スライダー入力変更時の処理を関数化
        function handleSliderInputChange(control) {
             if (!control) return;
             updateRatioDisplay(control);
             updateSliderBackground(control);
             mixColorsAndUpdateUI();
        }

        // ★ 保存リストクリック時の処理を関数化
        function handleSavedListClick(event) {
             const listItem = event.target.closest('li');
             if (listItem && listItem.dataset.index) {
                 const index = parseInt(listItem.dataset.index, 10);
                 restoreColorMix(index);
             }
        }


        // --- 他のヘルパー関数 (変更なし、実装省略) ---
        function hexToRgb(hex) { /* ... */ const shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i; hex = hex.replace(shorthandRegex, (m, r, g, b) => r + r + g + g + b + b); const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : null; }
        function rgbToHex(r, g, b) { /* ... */ const clamp = (val) => Math.min(255, Math.max(0, Math.round(val))); const toHex = (c) => clamp(c).toString(16).padStart(2, '0'); return `#${toHex(r)}${toHex(g)}${toHex(b)}`; }
        function mixColors() { /* ... */ let totalRatio = 0; let mixedR = 0, mixedG = 0, mixedB = 0; const activeColorsData = getActiveColorSettings(); activeColorsData.forEach(({ ratio }) => { totalRatio += ratio; }); if (activeColorsData.length === 0 || totalRatio === 0) return { r: 255, g: 255, b: 255 }; activeColorsData.forEach(({ rgb, ratio }) => { const weight = ratio / totalRatio; mixedR += rgb.r * weight; mixedG += rgb.g * weight; mixedB += rgb.b * weight; }); return { r: mixedR, g: mixedG, b: mixedB }; }
        function getActiveColorSettings() { /* ... */ const activeSettings = []; colorControls.forEach(control => { if (control.enableCheckbox.checked) { const rgb = hexToRgb(control.colorInput.value); const ratio = parseInt(control.ratioSlider.value, 10); if (rgb && ratio > 0) { activeSettings.push({ controlId: control.id, rgb, ratio, colorHex: control.colorInput.value }); } } }); return activeSettings; }
        function getCurrentSettingsSnapshot() { /* ... */ return colorControls.map(control => ({ id: control.id, color: control.colorInput.value, enabled: control.enableCheckbox.checked, ratio: parseInt(control.ratioSlider.value, 10) })); }
        function getContrastingTextColor(r, g, b) { /* ... */ const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255; return luminance > 0.6 ? '#333' : '#fff'; }
        function updateSliderBackground(control) { /* ... */ if (!control || !control.colorInput || !control.ratioSlider) return; const color = control.colorInput.value; const percentage = control.ratioSlider.value; control.ratioSlider.style.background = `linear-gradient(to right, ${color} ${percentage}%, #e0e0e0 ${percentage}%)`; }
        function updateAllSliderBackgrounds() { /* ... */ colorControls.forEach(updateSliderBackground); }
        function updateRatioDisplay(control) { /* ... */ if (!control || !control.ratioSlider || !control.ratioDisplay) return; control.ratioDisplay.textContent = `${control.ratioSlider.value}%`; }
        function mixColorsAndUpdateUI() { /* ... */ const mixedRgb = mixColors(); const finalHexColor = rgbToHex(mixedRgb.r, mixedRgb.g, mixedRgb.b); resultDisplay.style.backgroundColor = finalHexColor; resultText.textContent = finalHexColor.toUpperCase(); const textColor = getContrastingTextColor(mixedRgb.r, mixedRgb.g, mixedRgb.b); resultText.style.color = textColor; resultText.style.backgroundColor = textColor === '#333' ? 'rgba(255, 255, 255, 0.85)' : 'rgba(0, 0, 0, 0.5)'; }
        function createQuickSettingButtons(control) { /* ... */ if (!control || !control.quickSettingsContainer) return; const percentages = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100]; control.quickSettingsContainer.innerHTML = ''; percentages.forEach(p => { const button = document.createElement('button'); button.textContent = `${p}%`; button.type = 'button'; button.addEventListener('click', () => { if (!control.ratioSlider) return; control.ratioSlider.value = p; handleSliderInputChange(control); /* ★ 変更 */ }); control.quickSettingsContainer.appendChild(button); }); }


        // --- 保存と復元機能 (変更なし、実装省略) ---
        function loadSavedMixes() { /* ... */ try { const savedData = localStorage.getItem(LOCAL_STORAGE_KEY); if (savedData) { savedColorMixes = JSON.parse(savedData); savedColorMixes.sort((a, b) => b.timestamp - a.timestamp); } else { savedColorMixes = []; } } catch (error) { console.error("保存された色の読み込みに失敗しました:", error); savedColorMixes = []; } }
        function saveCurrentColorMix() { /* ... */ const currentSettings = getCurrentSettingsSnapshot(); const resultColor = resultText.textContent; const newMix = { timestamp: Date.now(), resultColor: resultColor, settings: currentSettings }; savedColorMixes.unshift(newMix); try { localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(savedColorMixes)); updateSavedListUI(); } catch (error) { console.error("色の保存に失敗しました:", error); savedColorMixes.shift(); alert("色の保存に失敗しました。ストレージの空き容量を確認してください。"); } }
        function updateSavedListUI() { /* ... */ savedColorsListElement.innerHTML = ''; if (savedColorMixes.length === 0) { const placeholder = document.createElement('li'); placeholder.textContent = "保存された色はありません"; placeholder.style.cssText = 'text-align: center; color: #888; cursor: default; border-bottom: none;'; savedColorsListElement.appendChild(placeholder); return; } savedColorMixes.forEach((mix, index) => { const listItem = document.createElement('li'); listItem.dataset.index = index; const swatch = document.createElement('span'); swatch.className = 'saved-color-swatch'; swatch.style.backgroundColor = mix.resultColor; const infoDiv = document.createElement('div'); infoDiv.className = 'saved-color-info'; const hexSpan = document.createElement('span'); hexSpan.className = 'saved-color-hex'; hexSpan.textContent = mix.resultColor; const detailsSpan = document.createElement('span'); detailsSpan.className = 'saved-color-details'; const activeDetails = mix.settings.filter(s => s.enabled && s.ratio > 0).map(s => `色${s.id}(${s.color}):${s.ratio}%`).join(', '); detailsSpan.textContent = activeDetails || "（単色または無効）"; detailsSpan.title = activeDetails; infoDiv.appendChild(hexSpan); infoDiv.appendChild(detailsSpan); listItem.appendChild(swatch); listItem.appendChild(infoDiv); savedColorsListElement.appendChild(listItem); }); }
        function restoreColorMix(index) { /* ... */ if (index < 0 || index >= savedColorMixes.length) return; const mixToRestore = savedColorMixes[index]; mixToRestore.settings.forEach(savedSetting => { const control = colorControls.find(c => c.id === savedSetting.id); if (control) { control.colorInput.value = savedSetting.color; control.enableCheckbox.checked = savedSetting.enabled; control.ratioSlider.value = savedSetting.ratio; updateRatioDisplay(control); /* updateSliderBackground は all で */ } }); updateAllSliderBackgrounds(); mixColorsAndUpdateUI(); }


        // --- 初期化処理 ---
        function initialize() {
            // クイック設定ボタン生成
            colorControls.forEach(createQuickSettingButtons);

            // スライダー背景初期化
            updateAllSliderBackgrounds();
            // 保存データ読み込み & UI更新
            loadSavedMixes();
            updateSavedListUI();
            // 初期色表示
            mixColorsAndUpdateUI();

            // ★ EyeDropper API サポート状況を一度だけチェックして表示
            if (!('EyeDropper' in window)) {
                console.warn("このブラウザは EyeDropper API をサポートしていません。スポイト機能は無効になります。");
                // 必要であればユーザー向けのメッセージを画面上に表示
                // const messageDiv = document.createElement('div');
                // messageDiv.textContent = 'お使いのブラウザではスポイト機能は利用できません。';
                // messageDiv.style.cssText = 'text-align: center; color: orange; margin-bottom: 15px;';
                // document.querySelector('.container').prepend(messageDiv); // コンテナの先頭に追加
            }
        }

        // --- 実行 ---
        document.addEventListener('DOMContentLoaded', initialize);

    </script>

</body>
</html>